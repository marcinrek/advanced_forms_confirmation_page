(()=>{function d(t){if(!t)return null;if(t instanceof Element)return t;if(typeof t.length=="number"&&t.length>0){for(let e=0;e<t.length;e++)if(t[e]instanceof Element)return t[e]}return null}function g(t){let e=d(t);return e?e.tagName==="INPUT"&&e.type==="hidden"?!!(e.classList&&e.classList.contains("hiddenfilevals")):!(e.name&&e.name==="frontend_event_log"||e.name&&e.name.startsWith("ajup_")||e.name&&e.name.startsWith("_")):!1}function v(t,e,i){let o=d(t);if(!o)return e||"";let n="";if(o.type==="radio"){let s=o.closest('.radio-group[role="radiogroup"]');if(s){let l=s.getAttribute("aria-labelledby");if(l){let a=document.getElementById(l);a&&(n=a.textContent.trim())}if(!n){let a=s.closest(".snap-field");if(a){let c=a.querySelector(".control-label");c&&(n=c.textContent.trim())}}}}if(!n&&o.id){let r=i.querySelector(`label[for="${o.id}"]`);r&&(n=r.textContent.trim())}if(!n){let r=o.closest&&o.closest("label");r&&(n=r.textContent.trim())}if(!n){let r=o.closest&&o.closest(".snap-field");if(r){let s=r.querySelector(".control-label");s&&(n=s.textContent.trim())}}return n||(n=e||o.name||""),n.replace(/\s*\*\s*/g," ").trim()}function q(t,e,i){let o=d(t);if(!o)return e;if(o.type==="hidden"&&o.classList&&o.classList.contains("hiddenfilevals")){if(!e||e.trim()===""||e.trim()==="[]")return"No files uploaded";try{let n=JSON.parse(e);if(Array.isArray(n)&&n.length>0)return n.map(r=>r.name||"Unnamed file").join(", ")}catch(n){console.warn("Failed to parse file upload JSON:",n,e)}return"No files uploaded"}if(o.type==="checkbox"){if(o.checked){let n=i.querySelector(`label[for="${o.id}"]`);return n?n.textContent.trim().replace(/\s*\*\s*/g," ").trim()||e:e||"Yes"}return e}if(o.type==="radio"){let n=t.length?t:i.elements[o.name],r=null;if(n&&typeof n.length=="number"){for(let s=0;s<n.length;s++)if(n[s].checked){r=n[s];break}}else o.checked&&(r=o);if(r){let s=i.querySelector(`label[for="${r.id}"]`);if(s)return s.textContent.trim();let l=r.closest("span");if(l){let a=l.querySelector("label");if(a)return a.textContent.trim()}}return e}return e}function C(t){let e=d(t);return e?e.closest&&(e.closest('section[role="tabpanel"]')||e.closest("section")||e.closest(".form-group")):null}function _(t){if(!t)return null;let e=t.querySelector("h1.fieldtype_heading, h2.fieldtype_heading, h3.fieldtype_heading, h4.fieldtype_heading, h5.fieldtype_heading, h6.fieldtype_heading");return e?e.textContent.trim():null}function x(t){return!!t.querySelector('a[href="#next"]')}function A(t){let e=t.querySelector('a[href="#finish"]');if(!e)return!1;let i=e.closest("li");return i&&i.style.display!=="none"&&i.getAttribute("aria-hidden")!=="true"}function L(t){let e=t.querySelector(".actions.clearfix")||t.querySelector(".actions");if(!e)return null;let i=t.querySelector("[data-form-summary]");i?(i.className="form-summary content clearfix",i.style.marginBottom="30px",i.style.minHeight="auto"):(i=document.createElement("section"),i.setAttribute("data-form-summary","true"),i.setAttribute("aria-live","polite"),i.setAttribute("role","region"),i.setAttribute("aria-labelledby","form-summary-heading"),i.setAttribute("tabindex","0"),i.className="form-summary content clearfix",i.style.marginBottom="30px",i.style.minHeight="auto",i.innerHTML=`
      <h2 id="form-summary-heading" class="form-summary__heading">Summary of your answers</h2>
    `,e.parentNode.insertBefore(i,e));let o=i.querySelector("h2");return i.innerHTML="",o&&i.appendChild(o),i}function E(t){let e=new Map,i=t.querySelectorAll('input.hiddenfilevals[type="hidden"]');for(let o of i){let n=o.name;if(!n)continue;let r=o.value||"";if(!(!r||r.trim()===""||r.trim()==="[]")){try{let s=JSON.parse(r);if(!Array.isArray(s)||s.length===0)continue}catch(s){continue}e.set(n,{field:o,value:r})}}return e}function F(t,e){let i=new FormData(t),o=t.querySelectorAll('input[type="checkbox"]:not(.hiddenfilevals)');for(let n of o){let r=n.name;!r||e.has(r)||n.checked&&g(n)&&e.set(r,{field:n,value:n.value||"Yes"})}for(let[n,r]of i.entries()){if(!r||e.has(n))continue;let s=t.elements[n];if(!s||!g(s))continue;let l=d(s);l&&l.type==="checkbox"||e.set(n,{field:s,value:r})}return e}function k(t,e,i){let o=new Set,n=null,r=null,s=null,l=Array.from(e.querySelectorAll("input, textarea, select"));for(let a of l){let c=a.name;if(!c||!i.has(c)||o.has(c))continue;let{field:h,value:S}=i.get(c);o.add(c);let y=C(h);if(y&&y!==n){s&&r&&(r.appendChild(s),t.appendChild(r)),n!==null&&t.appendChild(document.createElement("hr")),r=document.createElement("div"),r.className="form-summary__section",r.setAttribute("role","region");let u=_(y);if(u){let m=`summary-heading-${o.size}`,f=document.createElement("h3");f.id=m,f.className="form-summary__section-heading",f.textContent=u,f.setAttribute("tabindex","0"),r.setAttribute("aria-labelledby",m),r.appendChild(f)}s=document.createElement("div"),s.className="form-summary__fields",s.setAttribute("role","list"),n=y}if(s){let u=document.createElement("div");u.className="form-summary__field",u.setAttribute("tabindex","0"),u.setAttribute("role","listitem");let m=v(h,c,e),f=q(h,S,e);u.setAttribute("aria-label",`${m}: ${f}`),u.innerHTML=`<strong class="form-summary__field-label">${m}:</strong> <span class="form-summary__field-value">${f}</span>`,s.appendChild(u)}}s&&r&&(r.appendChild(s),t.appendChild(r))}function N(t="form"){let e=typeof t=="string"?document.querySelector(t):t;if(!e||!x(e))return;if(!A(e)){let n=e.querySelector("[data-form-summary]");n&&n.remove();return}let i=L(e);if(!i)return;let o=E(e);o=F(e,o),k(i,e,o)}function p(t){let e=t.querySelector('a[href="#finish"]');if(!e){let n=t.querySelector("[data-form-summary]");n&&n.remove();return}let i=e.closest("li");if(i&&i.style.display!=="none"&&i.getAttribute("aria-hidden")!=="true")N(t);else{let n=t.querySelector("[data-form-summary]");n&&n.remove()}}function b(){let t=document.querySelector("form");if(!t||!x(t))return;console.log("Summary script loaded");let e=t.querySelector('a[href="#next"]');e&&e.addEventListener("click",function(s){setTimeout(()=>p(t),100)});let i=t.querySelector('a[href="#previous"]');i&&i.addEventListener("click",function(s){setTimeout(()=>p(t),100)}),p(t);let o=new MutationObserver(function(s){p(t)}),n=t.querySelector('a[href="#finish"]'),r=t.querySelector(".actions");n&&n.closest("li")&&o.observe(n.closest("li"),{attributes:!0,attributeFilter:["style","aria-hidden"]}),r&&o.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","aria-hidden"]})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",b):b();})();
